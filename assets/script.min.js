function r(l,f){if(window.location.pathname==l){f()}}
function e(i){return document.getElementById(i)}
function d(m,u,d,c){var newXHR=new XMLHttpRequest();newXHR.addEventListener('load',c);newXHR.open(m,u);newXHR.setRequestHeader('Content-Type','application/x-www-form-urlencoded');newXHR.send(d);}
function a(t,m){var h=document.getElementsByTagName('header')[0],id=Math.random()
h.innerHTML='<flash '+t+' id="flash-'+id+'">'+m+'</flash>'
setTimeout(function(){e('flash-'+id).remove()},5000)}
function remove(el){d('DELETE','/u/a/del/'+el.getAttribute('data-link')+'?token='+t,null,function(){var response=JSON.parse(this.responseText)
if(response['error']){a('error',response['message'])
return}
a('info','Deleted')
el.parentNode.remove()
if(e('list-links').innerText.trim()==''){e('list-links').innerHTML='<p>No links found</p>'}})}
function removeTriggers(){var el_delete=document.getElementsByTagName('links-delete')
for(var i=0;i<el_delete.length;i++){el_delete[i].onclick=function(){if(confirm('are you sure to delete this?')){remove(this)}}}}
r('/',function(){var el_submit=e('b-submit'),el_link=e('i-link')
el_submit.onclick=function(e){e.preventDefault()
d('POST','/a/links','link='+encodeURI(el_link.value),function(){var response=JSON.parse(this.responseText)
if(response['error']){a('error',response['message'])
return}
var s=response['data']
a('info','<a href="/l/'+s+'">https://'+window.location.hostname+'/l/'+s+'</a>')
el_link.value=''})}})
r('/u/board',function(){var el_submit=e('b-submit'),el_link=e('i-link'),el_slug=e('i-slug'),el_links=e('list-links')
el_submit.onclick=function(e){e.preventDefault()
d('POST','/u/a/links?token='+t,'link='+encodeURI(el_link.value)+'&slug='+encodeURI(el_slug.value),function(){var response=JSON.parse(this.responseText)
if(response['error']){a('error',response['message'])
return}
var s=response['data']
a('info','<a href="/l/'+s+'">https://'+window.location.hostname+'/l/'+s+'</a>')
el_link.value=''
el_slug.value=''
if(el_links.innerText.trim()=='No links found'){el_links.innerHTML=''}
el_links.innerHTML+='<row>'+
'  <a href="/l/'+s+'">/'+s+'</a>'+
'  <visits>0</visits> visits'+
'  <links-delete class="links-delete" data-link="'+s+'">Delete</links-delete>'+
'</row>'
removeTriggers()})}
removeTriggers()})